---
title: "Q 5 Salary Data"
author: "Ana Paula Felix de Queiroz"
output:
  pdf_document: default
  word_document: default
  html_document: default
editor_options:
  chunk_output_type: console
---

```{=html}
<style type="text/css">

h1.title {
  font-size: 38px;
  font-family: "Times New Roman", Times, serif;
  color: #2a6592;
  text-align: center;
}
h4.author { /* Header 4 - and the author and data headers use this too  */
    font-size: 18px;
  font-family: "Times New Roman", Times, serif;
  color: #2a6592;
  text-align: center;
}
h4.date { /* Header 4 - and the author and data headers use this too  */
  font-size: 18px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
  text-align: center;
}
</style>
```
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = "C:/Users/pauli/OneDrive/Documentos/Classes 2023/311_tech")

library(car)

```

### Question 5:

#### - Are specific job titles being offered to candidates of a specific nationality?

#### - Does the nationality of the candidate affect the status of case?

```{r}
library(readxl)
df <- read_excel("salary_data_states.xlsx", col_types = c("text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text", "text"))

#summary(df)
```

```{r}
names(df)
#head(df)
#View(df)
attach(df)


check_missing_values <- function(df) {
  for (col in names(df)) {
    n_missing <- sum(is.na(df[[col]]))
    if (n_missing > 0) {
      message(paste0("Column ", col, " has ", n_missing, " missing values."))
    } else {
      message(paste0("Column ", col, " has no missing values."))
    }
  }
}


check_missing_values(df)
summary(df)




# Count the number of missing values in each column
sapply(df, function(x) sum(is.na(x)))


# Remove rows with missing values if needed
#cleaned_data <- na.omit(data)
# Save the cleaned data
#write.csv(cleaned_data, "cleaned_data.csv")


#unique(JOB_TITLE_SUBGROUP)

#clean the data and keep only data related jobs.
# Define the job titles you want to keep

```

# Data pre processing

It is important to notice that for this analysis we had a significant amount of missing values values on the column of interest. for instance we have a data set with 167278 observations but for column country of citizenship we have a total of 124106 missing values. Nevertheless, we will proceed with the analysis using the remaining 43172 observations.\
Since we are focusing our analysis on data related jobs we are also excluding all the job subtitles unrelated to data, as well

```{r}

JOB_TITLE_DATA <- c("software engineer", "business analyst", "management consultant", "data analyst", "data scientist")

# Filter the data to keep only the specified job titles
data <- df[df$JOB_TITLE_SUBGROUP %in% JOB_TITLE_DATA, ]

# Check the number of rows in the cleaned data
#nrow(data)
#nrow(df)


attach(data)
# Define a function to map case status to short initials
map_case_status <- function(x) {
  ifelse(x == "denied", "D", 
         ifelse(x == "certified-withdrawn", "CW",
                ifelse(x == "certified", "C",
                       ifelse(x == "withdrawn", "W", 
                              ifelse(x == "certified-expired", "CE", "U"))))) # "U" for unknown
}

# Apply the function to create a new variable
data$CASE_STATUS_SHORT <- map_case_status(data$CASE_STATUS)


# Replace "NA" with NA in the COUNTRY_OF_CITIZENSHIP column
data$COUNTRY_OF_CITIZENSHIP <- replace(data$COUNTRY_OF_CITIZENSHIP, data$COUNTRY_OF_CITIZENSHIP == "NA", NA)

dim(data)
# Omit rows with NA values
data <- na.omit(data)
dim(data)

```

#### - Are specific job titles being offered to candidates of a specific nationality?

In other words, we want to know if there a significant difference in number of hiring for a particular job subtitle considering country of citizenship.\
First we conducted an analysis in python looking at the top10 countries with higher hiring frequency. We then looked at the frequency of job subtitle in each of these countries.\
\
![](images/job_percentage_bycountry.png)

Key takeaways considering the top 10 countries with higher hiring percentage:

-   Software engineers are the most sough out professionals across the board in the top 10 countries.

-   Countries such as Canada, Russia, Taiwan, and China have over 90% of its hiring pool being directed to software engineers professionals.

-   Ukraine only hire software engineers

-   Nepal has the highest percentage of individuals working as business analysts, with over 28%. followed by Pakistan with over 18%.

-   Mexico has the highest percentage of individuals working as data analysts with over 6% of the pool of job titles.

-   Taiwan and China have the highest percentage of

-   China and Taiwan have the highest percentage of individuals working as data scientists, with over 1.4% and 1.3%.

-   Pakistan has the highest percentage of individuals working as management consultants, with over 1.3%.

    ![](images/job_percentage_bargraph.png)

#### - Does the nationality of the candidate affect the status of case?

We wanted to investigate whether the nationality of the candidate affects the status of the case (positive or negative) in the context of immigration applications. In order to have a binary response we code certified withdraw (which means the candidate withdraw their application after it was accepted) as positive together with certified, and we code certified-expired (which meant cadidate was aproved but company didnt went through with aplication We analyzed a dataset that contains information on the status of immigration cases for ten different countries. We used logistic regression analysis and ANOVA to test the significance of nationality as a predictor of case status.

The logistic regression analysis showed that the intercept is significant (p \< 0.001), indicating that there is a significant relationship between the predictor variable (country) and the response variable (positive or negative status). However, the individual coefficients for the different countries were not all significant (p \> 0.05). The ANOVA test also showed that there is a significant difference between at least two groups (p = 0.008), but it does not indicate which specific groups differ significantly.

Therefore, we conclude that the nationality of the candidate does have an effect on the status of the case, but the effect is not the same for all countries. Some countries may have a more significant impact on the case status than others. Further analysis is needed to identify which specific countries have a significant effect on the case status.

It is also important to note that the current analysis does not take into account other variables that may affect the case status, such as the type of visa application, the qualifications of the candidate, or the reasons for denial. Therefore, the current analysis should be considered as a preliminary investigation, and further research is necessary to fully understand the factors that affect the status of immigration cases.

In conclusion, while the nationality of the candidate does have a significant impact on the status of the case, the effect varies between different countries. Therefore, it is important to consider the candidate's nationality when analyzing the status of immigration cases, but it is also necessary to consider other factors that may affect the case status.

Therefore, we can conclude that there is no significant evidence that the nationality of the candidate affects the status of the case, based on the data provided.

```{r}

# Replace "NA" with NA in the COUNTRY_OF_CITIZENSHIP column
data$COUNTRY_OF_CITIZENSHIP <- replace(data$COUNTRY_OF_CITIZENSHIP, data$COUNTRY_OF_CITIZENSHIP == "NA", NA)

dim(data)

# Select the top 10 countries by count
top_countries <- names(sort(table(data$COUNTRY_OF_CITIZENSHIP), decreasing=TRUE))[1:10]

# Filter the data frame to only include top 10 countries
df_top10 <- data[data$COUNTRY_OF_CITIZENSHIP %in% top_countries, ]

# Calculate percentage of each case status for each country
table <- table(df_top10$COUNTRY_OF_CITIZENSHIP, df_top10$CASE_STATUS)
table_pct <- prop.table(table, margin = 1) * 100



# Create a data frame from the table
status <- data.frame(
  country = rownames(table),
  certified = table[, "certified"],
  certified_expired = table[, "certified-expired"],
  denied = table[, "denied"],
  withdrawn = table[, "withdrawn"]
)

# Perform chi-squared test of independence
chisq.test(status[, -1])

#######################################################################
# Subset the data for Canada
canada_data <- subset(data, COUNTRY_OF_CITIZENSHIP == "CANADA")

# Create a contingency table
canada_table <- table(canada_data$COUNTRY_OF_CITIZENSHIP, canada_data$CASE_STATUS)

# Perform chi-squared test
chisq.test(canada_table)

# Subset the data for Canada
china_data <- subset(data, COUNTRY_OF_CITIZENSHIP == "CHINA")

# Create a contingency table
china_table <- table(china_data$COUNTRY_OF_CITIZENSHIP, china_data$CASE_STATUS)

# Perform chi-squared test
chisq.test(canada_table)



#####################################################################

# Create a new data frame with the binary response variables
status_response <- data.frame(Country = rownames(status), 
                              Positive = rowSums(status[, c("certified", "withdrawn", "certified_expired")]), 
                              Negative = rowSums(status[, c("denied")]))
# Merge certified_expired and certified as Positive
status_response$Positive[status_response$Country %in% names(status) & !is.na(names(status))] <- 
  rowSums(status[, c("certified", "certified_expired")])[status_response$Country %in% names(status) & !is.na(names(status))]

# Remove rows with NAs
status_response <- na.omit(status_response)



# Create a logistic regression model with country as predictor and positive case status as response
model_pos <- glm(cbind(Positive,Negative) ~ factor(Country), data = status_response, family = binomial)

# Check the model summary
summary(model_pos)

Anova(model_pos)




```

\

\

\
